{% extends "base.html" %}

{% block body %}
<!--Menu Items-->
<div class="menu-page">
    <div class="food-grid">
    {% for food in foods %}
         <div class ="food-item">
             <img src="{{ url_for('static', filename=food.imageurl) }}" 
                alt="{{ food.food_name }}" 
                class="food-image"
                loading="lazy"
                srcset=" {{ url_for('static', filename=food.imageurl or 'images/default-food.webp') }} 320w">
            <div class ="food-text">    
                <span class="food-name">{{ food.food_name }}</span>
                <span class="food-price">${{ food.food_price }}</span> 
             </div>
            <button class="w3-button w3-teal cart-add" 
            data-food_id="{{ food.food_id }}" 
            data-food_name="{{ food.food_name }}" 
            data-food_price="{{ food.food_price }}" >
            Add to Cart
            </button>
        </div>
 {% endfor %}
    </div>
</div>

<!-- Cart Sidebar -->
<aside id="cart-container" class="cart-container">
    <button id="cart-button" class="cart-button" onclick="toggleCartSidebar()">&#8647;</button>

    <div id="cart-sidebar" class="cart-sidebar">
        <h3>Your Order</h3>
        <div id="cart-items">
            <!-- Cart items will be automatically added here -->
            {% for item in cart %}
                <p>{{ item.food_name }} - ${{ item.food.price }}</p>
            {% else %}
                <p>No items in cart.</p>
            {% endfor %}
        </div>
        
        <div class="order-type-selector">
            <button id="pickup-button" class="order-selector-button">Pick-up</button>
            <button id="delivery-button" class="order-selector-button">Delivery</button>
        </div>
        <button id="checkout-button" class="checkout-button">Checkout</button>
    </div>
</aside>


<script>
let isProcessing = false;

// Set initial state when the page loads
window.addEventListener('DOMContentLoaded', () => {
    const sidebar = document.getElementById('cart-container');
    const cartButton = document.getElementById('cart-button');
    const foodItems = document.querySelectorAll('.food-item');
    const menuPage = document.querySelector('.menu-page');
    
    // Initially open the sidebar
    sidebar.classList.add('open'); // Make the sidebar open by default
    sidebar.style.transform = 'translateX(0)'; // Ensure it's visible from the start
    menuPage.classList.remove('shrink'); // Remove the shrink layout
    foodItems.forEach(item => item.style.transform = 'scale(1)'); // Ensure food items are not shrunk initially
    cartButton.innerHTML = '&#8649;'; // Set button to close icon by default
});

function toggleCartSidebar() {
    if (isProcessing) return; // Prevent multiple rapid clicks
    isProcessing = true;

    requestAnimationFrame(() => {
        const sidebar = document.getElementById('cart-container');
        const cartButton = document.getElementById('cart-button');
        const foodItems = document.querySelectorAll('.food-item');
        const menuPage = document.querySelector('.menu-page');
        const isOpen = sidebar.classList.contains('open');
        
        // Toggle sidebar and update button icon
        sidebar.classList.toggle('open');
        cartButton.innerHTML = isOpen ? '&#8647;' : '&#8649';; // Toggle the cart button 
        
        // Apply scaling and padding adjustments
        if (isOpen) {
            sidebar.style.transform = 'translateX(100%)'; // Hide the sidebar
            menuPage.classList.add('shrink');
            foodItems.forEach(item => item.style.transform = 'scale(1)'); // Return food items to original size
        } else {
            sidebar.style.transform = 'translateX(0)'; // Show the sidebar
            menuPage.classList.remove('shrink');
            foodItems.forEach(item => item.style.transform = 'scale(0.9)'); // Shrink food items
        }

        isProcessing = false;
    });
}








</script>


{% endblock %}